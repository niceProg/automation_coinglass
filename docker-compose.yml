services:
  # =============================================================================
  # SYSTEM ADMINISTRATION
  # =============================================================================
  setup:
    build: .
    container_name: coinglass_setup
    env_file:
      - .env
    command: ["python", "main.py", "--setup"]
    restart: "no"
    profiles:
      - setup
    networks:
      - coinglass_network

  status:
    build: .
    container_name: coinglass_status
    env_file:
      - .env
    command: ["python", "main.py", "--status"]
    restart: "no"
    profiles:
      - monitoring
    networks:
      - coinglass_network

  freshness:
    build: .
    container_name: coinglass_freshness
    env_file:
      - .env
    command: ["python", "main.py", "--freshness"]
    restart: "no"
    profiles:
      - monitoring
    networks:
      - coinglass_network

  # =============================================================================
  # COINGLASS PIPELINES - 1 SERVICE PER ENDPOINT
  # =============================================================================

  # DERIVATIVES MARKET PIPELINES
  # =============================================================================

  # Funding Rate
  funding_rate:
    build: .
    container_name: coinglass_funding_rate
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=funding_rate
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Open Interest Aggregated History
  oi_aggregated_history:
    build: .
    container_name: coinglass_oi_aggregated_history
    env_file:
      - .env
    environment:
      - DELAY=20
      - PIPELINE=oi_aggregated_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Open Interest Aggregated Stablecoin History
  open_interest_aggregated_stablecoin_history:
    build: .
    container_name: coinglass_open_interest_aggregated_stablecoin_history
    env_file:
      - .env
    environment:
      - DELAY=35
      - PIPELINE=open_interest_aggregated_stablecoin_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Long Short Ratio Global
  long_short_ratio_global:
    build: .
    container_name: coinglass_long_short_ratio_global
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=long_short_ratio_global
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Long Short Ratio Top
  long_short_ratio_top:
    build: .
    container_name: coinglass_long_short_ratio_top
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=long_short_ratio_top
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Liquidation Aggregated
  liquidation_aggregated:
    build: .
    container_name: coinglass_liquidation_aggregated
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=liquidation_aggregated
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Liquidation Heatmap
  liquidation_heatmap:
    build: .
    container_name: coinglass_liquidation_heatmap
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=liquidation_heatmap
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Futures Basis
  futures_basis:
    build: .
    container_name: coinglass_futures_basis
    env_file:
      - .env
    environment:
      - DELAY=45
      - PIPELINE=futures_basis
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # Futures Footprint History
  futures_footprint_history:
    build: .
    container_name: coinglass_futures_footprint_history
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=futures_footprint_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # =============================================================================
  # SPOT MARKET PIPELINES
  # =============================================================================

  # Spot Orderbook
  spot_orderbook:
    build: .
    container_name: coinglass_spot_orderbook
    env_file:
      - .env
    environment:
      - DELAY=25
      - PIPELINE=spot_orderbook
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Orderbook Aggregated
  spot_orderbook_aggregated:
    build: .
    container_name: coinglass_spot_orderbook_aggregated
    env_file:
      - .env
    environment:
      - DELAY=25
      - PIPELINE=spot_orderbook_aggregated
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Coins Markets
  spot_coins_markets:
    build: .
    container_name: coinglass_spot_coins_markets
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=spot_coins_markets
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Pairs Markets
  spot_pairs_markets:
    build: .
    container_name: coinglass_spot_pairs_markets
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=spot_pairs_markets
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Price History
  spot_price_history:
    build: .
    container_name: coinglass_spot_price_history
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=spot_price_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Large Orderbook
  spot_large_orderbook:
    build: .
    container_name: coinglass_spot_large_orderbook
    env_file:
      - .env
    environment:
      - DELAY=25
      - PIPELINE=spot_large_orderbook
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Large Orderbook History
  spot_large_orderbook_history:
    build: .
    container_name: coinglass_spot_large_orderbook_history
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=spot_large_orderbook_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Aggregated Taker Volume History
  spot_aggregated_taker_volume_history:
    build: .
    container_name: coinglass_spot_aggregated_taker_volume_history
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=spot_aggregated_taker_volume_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # Spot Taker Volume History
  spot_taker_volume_history:
    build: .
    container_name: coinglass_spot_taker_volume_history
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=spot_taker_volume_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - spot
      - production

  # =============================================================================
  # BITCOIN ETF PIPELINES
  # =============================================================================

  # Bitcoin ETF List
  bitcoin_etf_list:
    build: .
    container_name: coinglass_bitcoin_etf_list
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=bitcoin_etf_list
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - etf
      - production

  # Bitcoin ETF Flows History
  bitcoin_etf_flows_history:
    build: .
    container_name: coinglass_bitcoin_etf_flows_history
    env_file:
      - .env
    environment:
      - DELAY=60
      - PIPELINE=bitcoin_etf_flows_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - etf
      - production

  # Bitcoin ETF Premium Discount History
  bitcoin_etf_premium_discount_history:
    build: .
    container_name: coinglass_bitcoin_etf_premium_discount_history
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=bitcoin_etf_premium_discount_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - etf
      - production

  # =============================================================================
  # MACRO & OPTIONS PIPELINES
  # =============================================================================

  # Bitcoin vs Global M2 Growth
  bitcoin_vs_global_m2_growth:
    build: .
    container_name: coinglass_bitcoin_vs_global_m2_growth
    env_file:
      - .env
    environment:
      - DELAY=3600
      - PIPELINE=bitcoin_vs_global_m2_growth
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - macro
      - production

  # Option Exchange OI History
  option_exchange_oi_history:
    build: .
    container_name: coinglass_option_exchange_oi_history
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=option_exchange_oi_history
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - derivatives
      - production

  # =============================================================================
  # SENTIMENT & ON-CHAIN PIPELINES
  # =============================================================================

  # Fear Greed Index
  fear_greed_index:
    build: .
    container_name: coinglass_fear_greed_index
    env_file:
      - .env
    environment:
      - DELAY=3600
      - PIPELINE=fear_greed_index
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - sentiment
      - production

  # Hyperliquid Whale Alert
  hyperliquid_whale_alert:
    build: .
    container_name: coinglass_hyperliquid_whale_alert
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=hyperliquid_whale_alert
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - sentiment
      - production

  # Whale Transfer
  whale_transfer:
    build: .
    container_name: coinglass_whale_transfer
    env_file:
      - .env
    environment:
      - DELAY=30
      - PIPELINE=whale_transfer
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
    profiles:
      - sentiment
      - production

  # =============================================================================
  # CRYPTOQUANT ENDPOINTS - 1 SERVICE PER TABLE
  # =============================================================================

  # CryptoQuant Exchange Inflow CDD
  cq_exchange_inflow_cdd:
    build: .
    container_name: cryptoquant_exchange_inflow_cdd
    env_file:
      - .env
    environment:
      - DELAY=900
      - PIPELINE=exchange_inflow_cdd
    entrypoint: ["/bin/bash", "/app/entrypoint.sh"]
    restart: unless-stopped
    networks:
      - coinglass_network
    dns:
      - 8.8.8.8
      - 8.8.4.4
      - 1.1.1.1
    profiles:
      - cryptoquant
      - production

networks:
  coinglass_network:
    driver: bridge
    name: coinglass_automation_network
    driver_opts:
      com.docker.network.bridge.name: coinglass-br0
